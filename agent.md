# AFC‑ConScribe 项目说明（Agent 指南）

本项目旨在为 GUI 智能体在高度动态的网页环境中提供“功能‑语义预处理”新范式：将网页 UI 从易变的 DOM 结构中解耦，抽象为稳定、可复用的“功能可见性组件（Affordances Function Component，AFC）”，并基于离线构建的功能知识库在运行时通过 RAG + VLM 实现稳健的语义‑视觉定位与操作，降低因前端变动导致的任务失败与“模型漂移”。

## 核心概念
- AFC（Affordances Function Component）：功能可见性组件，作为交互与理解的最小功能单元。
- MVFN（Multimodal Vision‑Fusion Network）：多模态融合模型，离线从截图 + 简化 DOM 识别 AFC。
- 规范化表示：对每个 AFC 存储 功能语义向量、操作类型（Click/Input/Select…）、规范化标签（如 Clickable_Submit）、历史/上下文链接。
- RAG（Retrieval‑Augmented Generation）：基于任务/步骤语义向量在 AFC 知识库中检索最相关节点。
- 动态 Grounding：轻量 VLM 将召回的 AFC 语义与当前截图/上下文对齐，得到坐标/边界框。

## 系统阶段
1) 离线预处理（知识库构建）
- 输入：页面截图 + 简化 DOM（结构/文本/可访问性信息）。
- 流程：MVFN 识别 AFC → 规范化为节点（语义向量、操作类型、标签、上下文链接）→ 写入知识库/向量索引。
- 目标：脱离前端实现细节，形成稳定、可检索的功能层知识。

2) 运行时策略（检索与定位）
- 意图解析与计划编译：将自然语言目标拆解为可执行步骤，确定前/后置断言。
- 知识检索：将步骤语义向量化，在知识库中召回相关 AFC 与技能模板。
- 上下文采集：截图、结构、可访问性与几何信息。
- 动态定位（Grounding）：VLM 将候选 AFC 与页面证据对齐，输出目标区域与置信度。
- 动作执行与断言：按 AFC 的标准操作执行，验证路由/属性/取值变化。
- 恢复与反馈：失败重排/视口调整/策略切换；缓存成功锚点，归档失效样本，更新阈值与知识库。

## 预期产物
- AFC 知识库：AFC 节点的结构化存储（含语义嵌入、标签、操作类型、上下文链接）。
- 向量索引：支持按步骤/任务语义的快速召回（本地向量库）。
- 运行时执行器：RAG + VLM 的检索、对齐、执行与断言模块。

## 初始里程碑（建议）
- M1：定义 AFC 本体与节点模式（字段、标签体系、操作类型）。
- M2：数据采集管线（截图、简化 DOM、可访问性树）与样本标注规范。
- M3：AFC 识别原型（可先基于启发式/弱监督，后续替换 MVFN）。
- M4：本地向量检索（嵌入抽取、索引构建、别名/模板过滤）。
- M5：VLM 定位原型（小型/轻量模型，对齐 AFC 语义 → 坐标）。
- M6：运行时执行/断言/恢复闭环与指标沉淀。

## 代码与目录建议（草案）
- src/afc：AFC 模型、节点与知识库 I/O。
- src/pipeline：离线预处理（采集、识别、规范化、入库）。
- src/runtime：RAG 检索、Grounding、动作执行与断言。
- src/utils：截图/DOM 处理、可访问性、几何与视口工具。
- data/ 与 experiments/：样本与实验记录（如需）。
- workspace/：临时材料与中间产物（本仓库默认忽略）。

## 开发约定
- 语言与风格：以 Python 为主，模块化、函数纯度优先，避免耦合 DOM 细节。
- 数据契约：AFC 节点与知识库格式保持向后兼容；变更需迁移脚本。
- 可测试性：关键路径（检索、定位、断言）提供可复现最小用例；优先端到端小闭环。
- 环境变量：敏感配置置于 `.env`（被 .gitignore 忽略）。

## 快速开始（占位）
- 安装依赖与本地向量库实现（后续补充）。
- 准备 `workspace/` 中的页面样本（截图 + 简化 DOM）。
- 运行 `src/pipeline` 生成 AFC 节点与索引，再用 `src/runtime` 驱动任务步骤。

如需我将本文件同步为 `AGENTS.md` 以便工具自动读取，请告知。当前已按需求创建 `agent.md` 并配置 `.gitignore` 忽略 `workspace/` 与 `.env`。
